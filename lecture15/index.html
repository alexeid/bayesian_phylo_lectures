---
lecture_num: 15
---

<section>
    <h2>The Coalescent Approximation Revisited</h2>
    <img data-src="WFrecap.svg" style="width:40%;padding:0;margin:0">

    <ul>
        <li class="fragment">Probability of distinct parents among $k$ sampled lineages in previous generation is:
            <div style="font-size:0.8em">
            \begin{align*}
            1-p_{c}(k) &amp;= \left(1-\frac{1}{N}\right)\left(1-\frac{2}{N}\right)\ldots\left(1-\frac{k-1}{N}\right)\\
            &amp; = 1 - \frac{1}{N}\sum_{j=1}^{k-1}j + O(N^{-2})
            \end{align*}</div></li>
        <li class="fragment"><b>Assumption</b>: $k\ll N$ so that $p_c(k)\simeq \binom{k}{2}/N$. (No multifurcation.)</li>
        <li class="fragment">Probability of coalescence after $m$ generations:
            <div style="font-size:0.8em">
                $$P(m)=(1-p_c(k))^m p_c(k)$$
            </div>
        </li>
        <li class="fragment">Since $N\gg k$, $p_c(k)\ll 1$ and thus $P(m)\simeq e^{-mp_c(k)}p_c(k)$, and
            <div style="font-size:0.8">
            $$P(t)=e^{-(t/g)p_c(k)}p_c{(k)}\frac{dm}{dt}=e^{-t\binom{k}{2}/Ng}\binom{k}{2}\frac{1}{Ng}$$
            </div></li>
    </ul>

</section>

<section>
    <h2>The linear birth-death-sampling process</h2>
    <ul>
        <li>Generalization of Yule model for speciation to include extinction and sampling by <a class="cite" href="http://dx.doi.org/10.1016/j.jtbi.2009.07.018">Tanja&nbsp;Stadler (2009)</a>.</li>
        <li>Also applied to populations, in particular measurably evolving pathogens.</li>
    </ul>

    <p>Equivalent to a population evoving under the following (forward-time) reactions:
    \begin{align*}
    X &amp; \overset{\lambda}{\longrightarrow} 2X\\
    X &amp; \overset{\mu}{\longrightarrow} 0
    \end{align*}
    In addition, a linear sampling process $\psi$ probabilistically generates samples, but does not otherwise affect the population. (No implicit removal on sampling!)</p>

    <img data-src="bds_tree.png" style="width:100%">

</section>

<section>
    <h2>The reconstructed birth-death-sampling tree</h2>

    <div class="figure">
    <img data-src="reconstructed_bds_tree.svg" style="width:80%;padding:1em">
    <div style="text-align:right"><a class="cite" href="http://dx.doi.org/10.1016/j.jtbi.2010.09.010">Stadler (2010)</a></div>
    </div>

    <ul style="margin-top:1em">
        <li>Left-hand tree is full tree, right-hand tree is equivalent "reconstructed" tree.</li>
        <li>How can we compute the probability of such a tree under the BDS process?</li>
    </ul>
</section>

<section>
    <h2>Flavour of derivation</h2>
    <div style="width:100%;border:solid 1px black;padding-top:0.2em;margin-bottom:0.5em;text-align:center">
        <div style="display:inline-block;width:59%;vertical-align:middle">
            <p>Let $p_0(t)$ be the probability that an individual alive at time $t$ has <b>no sampled descendents</b>. Then:
            \begin{align*}
            p_0(t+\Delta t) \simeq &amp; p_0(t)(1-\Delta (\lambda + \mu + \psi))\\
            &amp; + \Delta \mu + \Delta\lambda p_0(t)^2
            \end{align*}
            and so
            $$\dot{p}_0(t) = -(\lambda + \psi + \mu)p_0(t) + \mu - \lambda p_0(t)^2$$
            </p>
        </div>
        <div style="display:inline-block;width:18%;vertical-align:middle">
            <img data-src="noSampledDescendants.svg" style="width:100%;margin:0">
        </div>
    </div>

    <div style="width:100%;border:solid 1px black;padding-top:0;text-align:center">
        <div style="display:inline-block;width:59%;vertical-align:middle">
            <p>Let $g_e(t)$ be the probability that the sampled tree below time $t$ on edge $e$ <b>evolved as observed</b>. Then:
            $$\dot{g}_e(t) = -(\lambda + \psi + \mu)g_e(t) + 2\lambda p_0(t)g_e(t)$$
            where
            <div style="font-size:0.8em;margin-top:-0.5em">
            $$g_e(s)=\left\{\begin{array}{ll}
            \lambda g_{e_1}(s_1)g_{e_2}(s_2) &amp; \text{ if $e$ has two sampled desc.}\\
            \psi g_{e_1}(s_1) &amp; \text{ if $e$ has one sampled desc.}\\
            \psi p_0(s_1) &amp; \text{ if $e$ has no sampled desc.}
            \end{array}\right.$$
            </div>
            </p>
        </div>
        <div style="display:inline-block;width:20%;vertical-align:middle">
            <img data-src="probSampledTree.svg" style="width:100%;margin:0">
        </div>
    </div>

</section>

<section>
    <h2>Comparison with the coalescent</h2>

    <div class="figure">
        <img data-src="bdVersusCoal.svg" style="height:300px;padding:0.5em;vertical-align:middle">
        <img data-src="bdVersusCoal2.svg" style="height:300px;padding:0.5em;margin-left:1em;vertical-align:middle">

        <div class="cite" style="text-align:right;margin-top:1em"><a href="http://dx.doi.org/10.1098/rspb.2015.0420">Stadler et al. (2015)</a></div>
    </div>

    <ul>
        <li>Birth-death trees comparable to coalescent trees under exponential growth.</li>
        <li>Coalescent approximation breaks down when population sizes are small compared to ancestral lineage count.</li>
        <li>Figure on right shows CDFs for coalescent times under different models including coalescent (blue) and birth-death model (black).</li>
    </ul>
</section>

<section>
    <h2>Non-linear birth-death tree priors</h2>

    <ul>
        <li>If complete population trajectory (sequence of birth/death events) is known, probability of tree is easy:</li>
    </ul>

    <div style="width:100%;height:400px;position:relative">
        <img data-src="likelihoodFree12.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree11.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree10.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree9.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree8.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree7.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree6.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree5.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree4.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree3.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree2.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
        <img class="fragment" data-src="likelihoodFree.svg" style="position:absolute;top:0;left:0;width:100%;background-color:white">
    </div>
    <div class="fragment" style="margin-top:0.5em">Here $p_c=1/\binom{N}{2}$ and $p_{nc}=1-\binom{k}{2}/\binom{N}{2}$.</div>
    <ul class="fragment">
        <li>Use particle filtering to simulate conditioned trajectories, estimate tree probability.</li>
    </ul>
</section>

<section>
    <h2>Non-linear birth-death tree priors</h2>
    <p>Using this in MCMC lets us jointly infer the tree and the nonlinear birth-death trajectory:</p>

    <img data-src="SIR_psiSamp_Inference.png" style="width:70%">
</section>

<section>
    <h2>Summary</h2>

    <ul style="margin-top:5%" class="spaced">
        <li>Birth-death processes (and their corresponding branching processes)
            can be used to describe the generative process behind tree
            formation.</li>
        <li>In certain limits they yield the coalescent distribution for the
            sampled genealogy.</li>
        <li>Stadler et al. have shown that they can be used <b>directly</b> and
            without approximation to derive model-based tree priors that:
            <ul>
                <li>properly describe the effects of stochastic fluctuations in
                    small populations, and </li>
                <li>explicitly take sampling processes into consideration.</li>
            </ul>
        </li>
        <li>Extension to nonlinear birth-death process descriptions requires
        numerical methods such as particle filtering or numerical integration
        of master equations.</li>
    </ul>

</section>

<section>
    <h2>Further reading</h2>

    <ul style="margin-top:10%;width:80%" class="spaced">
        <li><a class="cite" href="http://dx.doi.org/10.1016/j.jtbi.2010.09.010">Stadler T., <i>Sampling through time in birth-death trees</i>,<br>J. Theoretical Biology, 2010</a></li>
        <li><a class="cite" href="http://dx.doi.org/10.1098/rspb.2015.0420">Stadler T. et al., <i>How well can the exponential-growth coalescent approximate constant-rate birth-death population dynamics?</i>,<br>Proc. R. Soc. B, 2015</a></li>
    </ul>
</section>
